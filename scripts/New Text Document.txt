// analytics.js

document.addEventListener('DOMContentLoaded', function() {

    // Helper function to send GA4 events safely
    function sendEvent(eventName, params) {
        if (typeof gtag === 'function') {
            gtag('event', eventName, params);
        } else {
            console.log('GA4 not loaded, event would be:', eventName, params);
        }
    }

    // --- 1. TRACK FILE DOWNLOADS ---
    // We select all links that contain '.pdf' in their href
    const downloadLinks = document.querySelectorAll('a[href$=".pdf"]');
    
    downloadLinks.forEach(link => {
        link.addEventListener('click', function() {
            // Get the filename from the href (e.g., "assets/pdf/example-a1.pdf" -> "example-a1.pdf")
            const fileName = this.getAttribute('href').split('/').pop();
            
            // Determine level based on filename for better labeling
            let label = 'Course PDF';
            if(fileName.includes('a1')) label = 'A1 Course PDF';
            if(fileName.includes('b1')) label = 'B1 Course PDF';
            if(fileName.includes('c1')) label = 'C1 Business Course PDF';

            sendEvent('file_download', {
                'event_category': 'Course Material',
                'event_label': label,
                'file_name': fileName
            });
        });
    });

    // --- 2. TRACK "ZAKAŽI ČAS" / "PRIJAVI SE" BUTTONS ---
    // Since you have many buttons, we can add a specific class to them in HTML 
    // to make selecting them easier, OR we can select them by href="#kontakt"
    
    const ctaButtons = document.querySelectorAll('a[href="#kontakt"]');

    ctaButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            // Try to identify which button was clicked based on text content
            const btnText = this.innerText.trim();
            
            // Determine location context (Navbar, Hero, Course Card)
            let category = 'General CTA';
            if (this.closest('.navbar')) category = 'Navigation';
            else if (this.closest('.hero')) category = 'Hero Section';
            else if (this.closest('.course-details-section')) category = 'Course Detail';
            else if (this.closest('.about-section')) category = 'About Section';

            sendEvent('click_cta', {
                'event_category': category,
                'event_label': btnText // e.g., "Zakaži Čas", "Prijavi se"
            });
        });
    });

    // --- 3. TRACK "IZABERI KURS" (Hero Button) ---
    const chooseCourseBtn = document.querySelector('a[href="#kursevi"]');
    if (chooseCourseBtn) {
        chooseCourseBtn.addEventListener('click', function() {
            sendEvent('click_cta', {
                'event_category': 'Navigation',
                'event_label': 'Hero - Izaberi Kurs'
            });
        });
    }

    // --- 4. TRACK FORM SUBMISSION ---
    // Note: We hook into the existing form submit event you already have in HTML.
    // However, it is cleaner to handle the GA event inside the 'analytics.js' 
    // only if we weren't depending on EmailJS success. 
    // Since your EmailJS logic is specific, we will attach a listener 
    // that listens for a custom event we will dispatch from your main HTML file.
    
    document.addEventListener('formSuccess', function(e) {
        sendEvent('form_submit', {
            'event_category': 'Engagement',
            'event_label': 'Contact Form Submission',
            'form_id': 'kontakt-forma',
            'course_interest': e.detail.course
        });
    });

});
